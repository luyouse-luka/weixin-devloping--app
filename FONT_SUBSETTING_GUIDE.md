# 字体子集化指南

## 什么是字体子集化？

字体子集化（Font Subsetting）是指从完整的字体文件中提取出**实际使用到的字符**，生成一个更小的字体文件。

### 为什么需要字体子集化？

- **中文字体文件很大**：完整的中文字体包含数万个字符，文件大小通常在 5-20MB
- **实际使用字符很少**：一个小程序可能只用到几百个汉字
- **显著减小文件大小**：子集化后可以减少 **90-99%** 的文件大小
- **提升加载速度**：更小的文件意味着更快的下载和加载

## 字体子集化方法

### 方法一：使用在线工具（最简单）

#### 1. 字蛛（Font-Spider）在线版
- 网址：http://font-spider.org/
- 优点：无需安装，直接使用
- 步骤：
  1. 上传字体文件
  2. 输入需要的文字
  3. 下载子集化后的字体

#### 2. Fontmin（喵喵字体）
- 网址：http://ecomfe.github.io/fontmin/
- 优点：可视化界面，功能强大
- 步骤：
  1. 拖入字体文件
  2. 输入需要保留的文字
  3. 生成并下载

### 方法二：使用 Node.js 工具（推荐）

我已经为您创建了一个自动化脚本，可以：
1. 扫描项目中所有使用的文字
2. 自动生成字体子集
3. 优化字体文件

#### 安装依赖

```bash
npm install --save-dev fontmin
```

#### 使用脚本

```bash
node subset_fonts.js
```

### 方法三：使用 Python 工具

#### 安装 fonttools

```bash
pip install fonttools brotli
```

#### 使用命令

```bash
# 提取指定文字
pyftsubset font.ttf --text="你需要的所有文字" --output-file=font-subset.woff2

# 或使用文本文件
pyftsubset font.ttf --text-file=chars.txt --output-file=font-subset.woff2
```

## 如何确定需要哪些字符？

### 1. 手动收集
- 查看所有页面的文本内容
- 列出所有使用的汉字、标点符号、数字、字母

### 2. 自动扫描（推荐）
使用我提供的脚本自动扫描项目文件

### 3. 常用字符集
- **基础集**：常用3500字 + 标点符号 + 数字 + 字母
- **扩展集**：6000-8000常用字
- **完整集**：根据实际需求

## 实际操作步骤

### 步骤1：收集项目中使用的所有文字

运行扫描脚本：
```bash
node scan_text.js
```

这会生成 `used_chars.txt` 文件，包含所有使用的字符。

### 步骤2：子集化字体

运行子集化脚本：
```bash
node subset_fonts.js
```

### 步骤3：验证结果

- 检查生成的字体文件大小
- 在小程序中测试字体显示
- 确认所有文字都能正常显示

## 优化建议

### 1. 格式选择
- **WOFF2**：最佳压缩率，推荐使用
- **WOFF**：兼容性好
- **TTF**：文件较大，不推荐

### 2. 字符集策略
- **标题字体**：只包含标题中使用的字符
- **正文字体**：包含所有正文字符
- **数字字体**：只包含数字和符号

### 3. 多字重处理
如果使用多个字重（如 Regular、Medium、Bold）：
- 为每个字重单独生成子集
- 确保字符集一致

## 文件大小对比示例

| 字体类型 | 原始大小 | 子集化后 | 压缩率 |
|---------|---------|---------|--------|
| 思源黑体 CN | 15.6 MB | 120 KB | 99.2% |
| 站酷快乐体 | 8.2 MB | 85 KB | 99.0% |
| Lexend | 180 KB | 25 KB | 86.1% |

## 注意事项

1. **保留足够的字符**
   - 包含所有当前使用的字符
   - 预留一些常用字符以备将来使用

2. **测试覆盖**
   - 测试所有页面
   - 检查动态内容
   - 验证用户输入场景

3. **版本控制**
   - 保留原始字体文件
   - 记录子集化的字符集
   - 便于后续更新

4. **更新流程**
   - 添加新内容时，检查是否需要新字符
   - 定期重新扫描和生成子集
   - 保持字体文件最新

## 下一步

运行以下命令开始字体子集化：

```bash
# 1. 安装依赖
npm install --save-dev fontmin

# 2. 扫描项目文字
node scan_text.js

# 3. 生成字体子集
node subset_fonts.js
```

生成的子集字体将保存在 `fonts/subset/` 目录中。
