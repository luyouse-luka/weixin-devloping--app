<view class="product-page">
<!-- 头部横幅和标题 -->
<view class="header">
  <image src="/images/banner.jpg" mode="aspectFill" class="banner"></image>
  <view class="title-container">
    <text class="couplet-line couplet-up">人间烟火气</text>
    <text class="couplet-line couplet-down">最抚凡人心</text>
    <text class="couplet-subtitle">大锤的食堂</text>
  </view>
</view>

<!-- 主体部分 -->
<view class="body">
  <!-- 左侧分类按钮 -->
  <view class="category-list" style="height: -374rpx; display: block; box-sizing: content-box">
    <block wx:for="{{categories}}" wx:key="id">
      <view 
        class="category-item {{activeCategoryId === item.id ? 'active' : ''}}" 
        bindtap="switchCategory" 
        data-id="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </view>

  <!-- 右侧商品列表 -->
<view class="product-list">
  <!-- 显示全部商品 -->
  <block wx:if="{{activeCategoryId === 0}}">
  <!-- 外层循环分类 -->
  <view 
    wx:for="{{categories}}" 
    wx:key="id"
    wx:if="{{item.id !== 0}}"  
  >
    <view class="category-section">
      <text class="category-title">{{item.name}}</text>

      <view 
        wx:for="{{categorizedProducts[item.id] || []}}" 
        wx:key="id"
        class="product-item"
      >
            <view class="image">
                <image src="{{item.image}}" mode="aspectFill" class="product-image" lazy-load="{{true}}" binderror="onImageError" data-id="{{item.id}}"></image>
            </view>
            <view class="text">
              <text class="product-name">{{item.name}}</text>
              <text class="product-intro" wx:if="{{item.intro}}">{{item.intro}}</text>
              <view class="price-row">
                <text class="product-price">¥{{item.price}}</text>
                <button class="add-to-cart" bindtap="addToCart" data-id="{{item.id}}">
                  <image src="/images/plus.svg" class="plus-icon"></image>
                </button>
              </view>
            </view>
        
      </view>
      


    </view>
  </view>
</block>

  <!-- 显示单个分类商品 -->
  <block wx:if="{{activeCategoryId !== 0}}">
    <block wx:for="{{filteredProducts}}" wx:key="id">
      <view class="product-item">
        <view class="image">
          <image src="{{item.image}}" mode="aspectFill" class="product-image" lazy-load="{{true}}" binderror="onImageError" data-id="{{item.id}}"></image>
         </view>
         <view class="text">
            <text class="product-name">{{item.name}}</text>
            <text class="product-intro" wx:if="{{item.intro}}">{{item.intro}}</text>
            <view class="price-row">
              <text class="product-price">¥{{item.price}}</text>
              <button class="add-to-cart" bindtap="addToCart" data-id="{{item.id}}">
                <image src="/images/plus.svg" class="plus-icon"></image>
              </button>
            </view>
         </view>
     
      </view>
    </block>
  </block>
</view>

</view>

<view class="cart-footer" style="height: 133rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 1316rpx; position: fixed">
  <button class="cart-btn" bindtap="showCartInfo" style="position: relative; left: -16rpx; top: 29rpx">
    <view class="cart-icon-wrapper">
      <image src="/images/cart.svg" class="cart-icon"></image>
      <view class="cart-badge" wx:if="{{cart.length > 0}}">{{cart.length}}</view>
    </view>
    <text class="cart-price">¥{{totalPrice}}</text>
  </button>
  <button class="order-btn" bindtap="goToOrder" style="position: relative; left: 12rpx; top: 30rpx; width: 243rpx; display: flex; box-sizing: border-box">下单</button>
</view>
<!-- 自定义购物车模态框 -->
<view class="cart-modal {{showCartModal ? 'show' : ''}}" bindtap="hideCartInfo">
  <view class="cart-modal-content" bindtap="stopPropagation">
    <view class="cart-modal-header">
      <text>购物车</text>
      <text class="close-btn" bindtap="hideCartInfo">×</text>
    </view>
    <view class="cart-modal-body">
      <block wx:if="{{cart.length > 0}}">
        <block wx:for="{{cart}}" wx:key="id">
          <view class="cart-item">
            <view class="cart-item-info">
              <text class="cart-item-name">{{item.name}}</text>
              <text class="cart-item-spec" wx:if="{{item.spec}}">规格: {{item.spec}}</text>
              <text class="cart-item-quantity">x{{item.quantity}}</text>
            </view>
            <text class="cart-item-price">¥{{item.price * item.quantity}}</text>
          </view>
        </block>
      </block>
      <view class="empty-cart-tip" wx:else>
        <text>购物车是空的</text>
      </view>
    </view>
    <!-- 新增清除购物车按钮 -->
    <button class="clear-cart-btn" bindtap="clearCart">清除购物车</button>
  </view>
</view>
</view>

<!-- 提取公共商品渲染模板 -->
<template name="productItem">
    <view class="product-item">
        <view class="image">
            <image src="{{item.image}}" mode="aspectFit" class="product-image"></image>
        </view>
        <view class="text">
            <text class="product-name">{{item.name}}</text>
            <text class="product-price">价格: {{item.price}} 元</text>
            <button class="add-to-cart" bindtap="addToCart" data-id="{{item.id}}"> <image src="/images/plus.svg"></image></button>
        </view>
    </view>
</template>
