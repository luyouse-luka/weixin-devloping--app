<view class="product-page">
<!-- 头部横幅和标题 -->
<view class="header">
  <image src="https://family-app-images.oss-cn-shanghai.aliyuncs.com/banner.jpg" mode="aspectFill" class="banner"></image>
  <view class="title-container">
    <text class="couplet-line couplet-up">熬夜撸串不爆痘</text>
    <text class="couplet-line couplet-down">贪吃狂睡不长肉</text>
    <text class="couplet-subtitle">大锤不喂闲人</text>
  </view>
</view>

<!-- 主体部分 -->
<view class="body">
  <!-- 左侧分类按钮 -->
  <view class="category-list" style="height: -374rpx; display: block; box-sizing: content-box">
    <block wx:for="{{categories}}" wx:key="id">
      <view 
        class="category-item {{activeCategoryId === item.id ? 'active' : ''}}" 
        bindtap="switchCategory" 
        data-id="{{item.id}}"
      >
        {{item.name}}
      </view>
    </block>
  </view>

  <!-- 右侧商品列表 -->
<view class="product-list">
  <!-- 显示全部商品 -->
  <block wx:if="{{activeCategoryId === 0}}">
  <!-- 外层循环分类 -->
  <view 
    wx:for="{{categories}}" 
    wx:key="id"
    wx:if="{{item.id !== 0}}"  
  >
    <view class="category-section">
      <text class="category-title">{{item.name}}</text>

      <view 
        wx:for="{{categorizedProducts[item.id] || []}}" 
        wx:key="id"
        class="product-item {{item.selected ? 'selected' : ''}}"
        bindtap="toggleSelect"
        data-id="{{item.id}}"
      >
        <view class="image">
          <image src="{{item.image}}" mode="aspectFill" class="product-image" lazy-load="{{true}}" binderror="onImageError" data-id="{{item.id}}"></image>
        </view>
        <view class="text">
          <text class="product-name">{{item.name}}</text>
          <text class="product-intro" wx:if="{{item.intro}}">{{item.intro}}</text>
          <text class="product-sold">价值 {{item.price}} 宝石</text>
          <view class="like-row" catchtap="toggleLike" data-id="{{item.id}}">
            <text class="heart-icon">{{item.liked ? '❤' : '♡'}}</text>
            <text class="like-count">好评</text>
          </view>
          <text class="click-count">已经点了 {{item.orderCount || 0}} 次</text>
        </view>
      </view>
      


    </view>
  </view>
</block>

  <!-- 显示单个分类商品 -->
  <block wx:if="{{activeCategoryId !== 0}}">
    <block wx:for="{{filteredProducts}}" wx:key="id">
      <view class="product-item {{item.selected ? 'selected' : ''}}" bindtap="toggleSelect" data-id="{{item.id}}">
        <view class="image">
          <image src="{{item.image}}" mode="aspectFill" class="product-image" lazy-load="{{true}}" binderror="onImageError" data-id="{{item.id}}"></image>
        </view>
        <view class="text">
          <text class="product-name">{{item.name}}</text>
          <text class="product-intro" wx:if="{{item.intro}}">{{item.intro}}</text>
          <text class="product-sold">价值 {{item.price}} 宝石</text>
          <view class="like-row" catchtap="toggleLike" data-id="{{item.id}}">
            <text class="heart-icon">{{item.liked ? '❤' : '♡'}}</text>
            <text class="like-count">好评</text>
          </view>
          <text class="click-count">已经点了 {{item.orderCount || 0}} 次</text>
        </view>
      </view>
    </block>
  </block>
</view>

</view>

</view>

<!-- 底部操作：让谁来做这些菜 -->
<view class="cart-footer">
  <button class="order-btn" bindtap="goToChooseCook">
    今天谁下厨
    <view class="selected-count-badge" wx:if="{{selectedCount > 0}}">{{selectedCount}}</view>
  </button>
</view>

